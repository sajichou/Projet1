<div class="row justify-content-center my-5">
	<div class="col-11">
		<div class="row">
			<!-- Rappel des caractéristiques du cours -->
			<div class="col-sm-3">
				<div class="d-flex mb-1 show_pastille">
					<div class="pl-4">
						<i class="fa fa-map-marker fa-lg"></i>
					</div>
					<div class="pl-2">
						<%= @cour.lieu_court %>
					</div>
				</div>
				<div class="d-flex mb-1 show_pastille">
					<div class="pl-4">
						<i class="fa fa-book fa-lg"></i>
					</div>
					<div class="pl-2">
						<%= @cour.matiere %>
						<%@cour.annees.each do |n| %>
							| <%= Correspondance.find_by_niveau_id(n.niveau).nom%>	
						<%end%>	
					</div>
				</div>
				<div class="d-flex mb-1 show_pastille">
					<div class="pl-4">
						<i class="fa fa-users fa-lg"></i>
					</div>
					<div class="pl-2">
						<% if @cour.nombre_eleves<2 %>
							<%= 3-@cour.nombre_eleves %> places disponibles
						<% else %>
							<%= 3-@cour.nombre_eleves %> place disponible
						<% end %>
					</div>
				</div>	
				<!--Horaire -->
				<!-- 1er cas : Horaire déjà fixé -->
				<% if (@cour.jour.present? and @cour.heure.present?) %>
					<div class="d-flex mb-1 show_pastille">
						<div class="pl-4">
							<i class="fa fa-calendar fa-lg"></i>
						</div>
						<div class="pl-2" style="text-transform: capitalize">
							<% if @cour.min == 0 %>
								<%=@cour.jour%> | <%=@cour.heure %>h - <%=@cour.heure+1 %>h30
							<% else %>
								<%=@cour.jour%> | <%=@cour.heure %>h30 - <%=@cour.heure+2 %>h
							<% end %>
						</div>
					</div>
				<!-- 2eme cas : Horaire pas encore fixé -->		
				<% else %>
					<div class="d-flex show_pastille_speciale">
						<div class="pl-4">
							<i class="fa fa-calendar fa-lg"></i>
						</div>
						<div class="pl-2">
							Choisis ton horaire :
						</div>
					</div>
					<div style="border:solid 1px #e55966; background-color: #eeeeee">
						<div class="row">
							<div class="col-12">
								<%=form_tag "/cours/show", method:"post" do %>
									<div class="d-flex flex-wrap justify-content-center">							
										<% @l.each do |j| %>
											<div>
												<table class="table">
													<thead>
														<tr>
															<th><%=j%></th>
														</tr>
													</thead> 
													<tbody>
														<%@cour.dispos.where(jour:j).each do |jh| %>
															<tr>
																<th>
																	<div class="btn-group btn-group-toggle" data-toggle="buttons">
																	<label class="btn" id="btn_active" style="background-color: #e0e0e0">
							   										 <input type="radio" name="dispo" id="option1" autocomplete="off" value="<%=j%>,<%=jh.heure%>,<%=jh.min%>" required>
							   										 <% if jh.min == 0%>
							   										 	<%=jh.heure%>h
							   										 <% else %>
							   										 	<%=jh.heure%>h<%=jh.min%>
							   										 <% end%>
							 										 </label>
																	</div>
																</th>
															</tr>
														<% end %>
													</tbody>
												</table>
											</div>
										<%end%>	
									</div>
									<%= hidden_field_tag "id", @cour.id %>
									<div class="row justify-content-center">
										<div  class="col-6 bleu" style="border:solid 1px black; border-top-left-radius: 15px; border-top-right-radius: 15px; height:30px"><%= submit_tag "M'inscrire", class:"submit_tag"%>
										</div>
									</div>
								<%end%>				
							</div>
						</div>
					</div>	
					
				<% end %>
				<!-- Fin horaire -->	
			</div>
			<div class="col-sm-9">			
				<div class="row justify-content-center">
					<div class="col-sm-4 mh-100">
						<div class="row justify-content-center">
							<div class="col-12">
							<%= image_tag @cour.teacher.infoteacher.avatar.url(:thumb), :class => "thumbnail2" %>
							</div>
							<div class="col-12">
							<%= @cour.teacher.infoteacher.first_name %>
							</div>
							<div class="col-12"">
								<div class="row justify-content-center" >
									<div class="col-10">

									<!--	NOTATION ENSEIGNANT						
										<div class="d-flex">
											<div style="color: #ffc400">
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="fa fa-star"></i>
												<i class="small">(9 avis)</i>
											</div>
										</div>
									-->
										<div class="d-flex">
											<div style="color: rgba(76, 175, 80, 0.7)">
												<i class="fa fa-check-circle-o"></i>
											</div>
											<div>
												<p class="ml-2" style="font-size: 90%">Profil vérifié</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- Avatars eleves -->
						<div class="row justify-content-center">
							<!-- Cas où 2 eleves sont déjà inscrits -->
							<% if @cour.nombre_eleves == 2%>
								<div class="col">
									<div class="avatar_occupe">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
								<div class="col">
									<div class="avatar_occupe">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>										
								<div class="col">
									<div class="avatar_libre">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
							<!-- Cas où 3 eleves sont déjà inscrits -->
							<% elsif @cour.nombre_eleves == 3%>
								<div class="col">
									<div class="avatar_occupe">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
								<div class="col">
									<div class="avatar_occupe">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>										
								<div class="col">
									<div class="avatar_occupe">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
							<!-- Cas où 1 eleve est déjà inscrit -->
							<% elsif @cour.nombre_eleves == 1 %>		
								<div class="col-3">
									<div class="avatar_occupe">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
								<div class="col-3">
									<div class="avatar_libre">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>											
								<div class="col-3">
									<div class="avatar_libre">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
							<!-- Aucun eleves d'inscrit -->
							<% else %>
								<div class="col">
									<div class="avatar_libre">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
								<div class="col">
									<div class="avatar_libre">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>										
								<div class="col">
									<div class="avatar_libre">
										<i class="fa fa-user-circle-o"></i>
									</div>
								</div>
							<% end %>										
						</div>				
					</div>
						<!-- fin avatars eleves -->
						<!-- Section de droite -->
					<div class="col-sm-8" >
						<div class="row">
							<div class="col-12" style="background-color: #eeeeee; border-radius: 10px">
								<h5 class="mt-2">Description du cours</h5>
								<p class="font-italic text-justify" style="font-size:90%"><%=@cour.descriptif%></p>
								<h5 class="mt-2">Expérience</h5>
								<p class="font-italic text-justify" style="font-size:90%"><%=@cour.teacher.infoteacher.experience%></p>
								<h5>Méthodologie</h5>
								<p class="font-italic text-justify" style="font-size:90%"><%=@cour.teacher.infoteacher.methodology%></p>								
							</div>
						
							<% if (@cour.nombre_eleves<3 and !teacher_signed_in? and @cour.jour.present? and @cour.heure.present?) %>
									<div class="col-12 col-lg-4 bleu" style="border:solid 1px black; border-radius: 10px; height:30px">
										
										<%= link_to "M'inscrire", {:controller =>"charges", :action=>"new", :id=>@cour.id}, class:"link_to" %>

									</div>
								
							<% elsif (teacher_signed_in? and current_teacher.id == @cour.teacher_id) %>
									<div class="col-12 col-lg-4 bleu" style="border:solid 1px black; border-radius: 10px ; height:30px">
										<%= link_to "Modifier", {:controller =>"cours", :action=>"modifier", :id=>@cour.id}, class:"link_to" %>
									</div>
									<div class="col-12 col-lg-4 ml-auto bleu" style="border:solid 1px black; border-radius: 10px; height:30px">
										<button type="button" class="btn btn-link" data-toggle="modal" data-target="#exampleModal" style="">
						  					Supprimer ce cours
										</button>
									</div>
								
							<%end%>	
							<% if !teacher_signed_in? %>
								<div class="col-12 col-lg-4 bleu" style="border:solid 1px black; border-radius: 10px; height:30px">
									<button type="button" class="btn btn-link" data-toggle="modal" data-target="#ContacterProf">
					  					Contacter
									</button>
								</div>
							<% end %>
							<% if @est_inscrit%>
								<div class="col-12 col-lg-4 bleu" style="border:solid 1px black; border-radius: 10px ; height:30px">
									<%= link_to "Signaler mon absence", {:controller =>"cours", :action=>"absence_show", :cour_id=>@cour.id}, class:"link_to" %>
								</div>								
							<% end %>
						</div>
					</div>			
				</div>
			</div>


			<!-- Modal  Supprimer cours pour teacher-->
			<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title" id="exampleModalLabel">Supprimer ce cours</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			        Je confirme mon souhait de supprimer ce cours. Avant de valider votre choix, nous vous conseillons de prévenir les élèves inscrits de la fin de leur cours. 
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
			        <%= link_to "Supprimer le cours", {:controller =>"cours", :action=>"destroy", :id=>@cour.id}, class:"btn btn-danger"%>
			      </div>
			    </div>
			  </div>
			</div>

			<!-- Modal Contacter prof -->

			<div class="modal fade" id="ContacterProf" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header text-center">
			                <h4 class="modal-title w-100 font-weight-bold">Envoyer un message</h4>
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			                    <span aria-hidden="true">&times;</span>
			                </button>
			            </div>
			            <div class="modal-body mx-3">

			            <%=form_tag("/cours/show", method: "post") do %>
<!--
						<label class="sr-only" for="Email">Email</label>
			            <div class="input-group mb-3">
							<div class="input-group-prepend">
								<div class="input-group-text"><span class="fa fa-envelope-o"></span></div>
							</div>
							<input type="text" class="form-control" id="Email" name="email" placeholder="Email">
						</div>
-->
			            <div class="input-group mb-3">
							<div class="input-group-prepend">
								<div class="input-group-text"><span class="fa fa-pencil"></span></div>
							</div>
							<textarea type="text" class="form-control" id="Message" name="message"></textarea>
						</div>
						<input type="hidden" name="cour_id" value='<%=@cour.id%>'>
			            <div class="modal-footer">
			                <div class="input-group mb-3">
								<div class="input-group-prepend">
									<div class="input-group-text"><span class="fa fa-paper-plane-o"></span></div>
								</div>
								<input type="submit" class="btn btn-primary form-control" value="Envoyer" name="contactprof">
							</div>
			            </div>
			            <% end %>
			        </div>
			    </div>
			</div>
			<!-- Fin Modal contacter prof -->
			
			</div>
		</div>
	</div>
</div>

<% if (teacher_signed_in? and current_teacher.id == @cour.teacher_id) %>
	<%=form_tag("/cours/show", method: "post") do %>
	<% if Inscription.where(cour_id:@cour.id).length > 0 %>
		<div class="row">
			<div class="col-1"></div>
			<div class="col-10">
				<% Inscription.where(cour_id:@cour.id).each do |i| %>
					<div class="row">
						<div class="col-6">
							<p style="font-weight: bold; font-size: 1.1em; text-align: start; border-bottom: solid 1px black">
								<%=User.find(i.user_id).infouser.first_name%> <%=User.find(i.user_id).infouser.last_name%>
							</p>
						</div>
						<div class="col-12"></div>
						<div class="col-3" style="padding:0px">
							<input type="text" name="<%=i.user_id%>[datepicker][]" class="datepicker" placeholder="Date du cours" style=" min-height:50px; min-width:230px; border: solid 1px black; text-align: center; color: #444A55; margin-left: 0px">
						</div>
						<div class="col-3">
							<textarea type="text" style="min-height:50px; min-width:500px; border: solid 1px black; text-align: center;" name="<%=i.user_id%>[commentaire][]" minlength="10" maxlength="100" placeholder="Commentaire pour l'élève"></textarea>
						</div>
					</div>
				<% end %>
			</div>
		</div>
		<div class="row mt-4">
			<div class="col-1"></div>
			<div class="col-3" >
				<input type="hidden" name="cour_id" value='<%=@cour.id%>'>
				<input type="submit" class="btn btn-primary form-control" value="Envoyer" name="commentaire">
			</div>
		</div>
		<% end %>
	<% end %>
<% end %>

<script type="text/javascript">
		 	$.extend($.fn.pickadate.defaults, {
			  monthsFull: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
			  weekdaysShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
			  today: '',
			  clear: '',
			  close: 'Fermer',
			  formatSubmit: 'dd-mm-yyyy',
			})

			$('.datepicker').pickadate({
				hiddenName:true
			})


		</script>